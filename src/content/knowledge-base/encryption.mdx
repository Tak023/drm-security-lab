---
title: "Encryption Basics"
description: "Understanding the cryptographic foundations of DRM - AES, RSA, and how content is protected."
category: "encryption"
difficulty: "beginner"
estimatedReadTime: 30
order: 5
tags: ["encryption", "aes", "rsa", "cryptography", "cenc"]
relatedArticles: ["overview", "widevine", "fairplay", "playready"]
---

# Encryption Basics for DRM

Understanding DRM requires a solid grasp of the cryptographic primitives that protect content. This article covers the essential concepts without requiring a mathematics background.

## Why Encryption Matters

Streaming content travels over the internet, passing through many networks before reaching your device. Without encryption:

- ISPs could inspect and copy content
- Network attackers could intercept streams
- Content could be redistributed freely

<KeyConcept term="Encryption">
Encryption transforms readable content (plaintext) into unreadable data (ciphertext) using a secret key. Only those with the correct key can reverse the process (decryption).
</KeyConcept>

## Symmetric vs Asymmetric Encryption

DRM uses both types of encryption:

```
┌─────────────────────────────────────────────────────────────────┐
│              Symmetric Encryption                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   [Plaintext] ──(Same Key)──► [Ciphertext]                      │
│   [Ciphertext] ──(Same Key)──► [Plaintext]                      │
│                                                                  │
│   Fast, used for bulk content encryption                        │
│                                                                  │
├─────────────────────────────────────────────────────────────────┤
│              Asymmetric Encryption                               │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   [Plaintext] ──(Public Key)──► [Ciphertext]                    │
│   [Ciphertext] ──(Private Key)──► [Plaintext]                   │
│                                                                  │
│   Slow, used for key exchange and signatures                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

<InfoBox title="Hybrid Approach">
DRM systems use asymmetric encryption to securely deliver symmetric keys, then use those fast symmetric keys to encrypt/decrypt the actual content.
</InfoBox>

## AES (Advanced Encryption Standard)

AES is the workhorse of content encryption. All major DRM systems use AES-128.

### How AES Works (Simplified)

```
┌─────────────────────────────────────────────────────────────────┐
│                    AES-128 Encryption                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   Input: 128-bit block of plaintext                             │
│   Key: 128-bit secret key                                       │
│                                                                  │
│   ┌─────────────┐                                               │
│   │ Plaintext   │                                               │
│   │ Block       │                                               │
│   └──────┬──────┘                                               │
│          │                                                       │
│   ┌──────▼──────┐                                               │
│   │ Round 1     │◄── Round Key 1                                │
│   └──────┬──────┘                                               │
│          │                                                       │
│   ┌──────▼──────┐                                               │
│   │ Round 2     │◄── Round Key 2                                │
│   └──────┬──────┘                                               │
│          │                                                       │
│          ⋮  (10 rounds total for AES-128)                       │
│          │                                                       │
│   ┌──────▼──────┐                                               │
│   │ Round 10    │◄── Round Key 10                               │
│   └──────┬──────┘                                               │
│          │                                                       │
│   ┌──────▼──────┐                                               │
│   │ Ciphertext  │                                               │
│   │ Block       │                                               │
│   └─────────────┘                                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Key Size

| Key Size | Security Level | DRM Usage |
|----------|---------------|-----------|
| AES-128 | Standard | Most streaming content |
| AES-256 | High | Highest value content |

<WarningBox title="Key Protection">
AES is extremely secure when keys are properly protected. DRM attacks focus on extracting keys, not breaking AES itself.
</WarningBox>

## Block Cipher Modes

AES operates on 128-bit (16-byte) blocks. To encrypt longer content, we need a **mode of operation**.

### CTR Mode (Counter)

Used by Widevine and PlayReady:

```
┌─────────────────────────────────────────────────────────────────┐
│                    AES-CTR Mode                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   Nonce + Counter 0    Nonce + Counter 1    Nonce + Counter 2   │
│         │                    │                    │              │
│         ▼                    ▼                    ▼              │
│   ┌───────────┐        ┌───────────┐        ┌───────────┐       │
│   │ AES Block │        │ AES Block │        │ AES Block │       │
│   │  Encrypt  │        │  Encrypt  │        │  Encrypt  │       │
│   └─────┬─────┘        └─────┬─────┘        └─────┬─────┘       │
│         │                    │                    │              │
│         ▼                    ▼                    ▼              │
│   Keystream 0          Keystream 1          Keystream 2         │
│         │                    │                    │              │
│    XOR ⊕                XOR ⊕                XOR ⊕              │
│         │                    │                    │              │
│   Plaintext 0          Plaintext 1          Plaintext 2         │
│         │                    │                    │              │
│         ▼                    ▼                    ▼              │
│   Ciphertext 0         Ciphertext 1         Ciphertext 2        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**Advantages:**
- Parallelizable (fast)
- Random access (seek-friendly)
- Same algorithm for encrypt/decrypt

<KeyConcept term="IV/Nonce">
The Initialization Vector (IV) or Nonce ensures the same plaintext encrypts to different ciphertext each time. It's typically 8-16 bytes and must be unique per encryption.
</KeyConcept>

### CBC Mode (Cipher Block Chaining)

Used by FairPlay (SAMPLE-AES):

```
┌─────────────────────────────────────────────────────────────────┐
│                    AES-CBC Mode                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│       IV              Ciphertext 0         Ciphertext 1         │
│       │                    │                    │               │
│       ▼                    ▼                    ▼               │
│   ┌───────┐           ┌───────┐           ┌───────┐            │
│   │ XOR ⊕ │◄──────────│ XOR ⊕ │◄──────────│ XOR ⊕ │◄───...     │
│   └───┬───┘           └───┬───┘           └───┬───┘            │
│       │                   │                   │                 │
│  Plaintext 0         Plaintext 1         Plaintext 2            │
│       │                   │                   │                 │
│       ▼                   ▼                   ▼                 │
│   ┌───────────┐       ┌───────────┐       ┌───────────┐        │
│   │ AES Block │       │ AES Block │       │ AES Block │        │
│   │  Encrypt  │       │  Encrypt  │       │  Encrypt  │        │
│   └─────┬─────┘       └─────┬─────┘       └─────┬─────┘        │
│         │                   │                   │               │
│         ▼                   ▼                   ▼               │
│   Ciphertext 0         Ciphertext 1         Ciphertext 2        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

**Characteristics:**
- Sequential (harder to parallelize)
- Each block depends on previous
- Requires padding

## CENC (Common Encryption)

CENC is the standard that enables multi-DRM with single encryption:

```
┌─────────────────────────────────────────────────────────────────┐
│                    CENC Structure                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────────────────────────────────────┐           │
│   │              Encrypted Content                   │           │
│   │         (One encryption, AES-CTR)               │           │
│   └───────────────────────┬─────────────────────────┘           │
│                           │                                      │
│           ┌───────────────┼───────────────┐                     │
│           │               │               │                     │
│           ▼               ▼               ▼                     │
│    ┌──────────┐    ┌──────────┐    ┌──────────┐                │
│    │ Widevine │    │ FairPlay │    │PlayReady │                │
│    │  PSSH    │    │   sinf   │    │   PSSH   │                │
│    └──────────┘    └──────────┘    └──────────┘                │
│                                                                  │
│   Each DRM can decrypt the same content with its own            │
│   license delivery mechanism                                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

<KeyConcept term="PSSH">
Protection System Specific Header (PSSH) boxes contain DRM-specific initialization data. Each DRM has its own PSSH with key IDs and license server information.
</KeyConcept>

### CENC Encryption Patterns

```
Video Sample
┌─────────────────────────────────────────────────────────────────┐
│ NAL Header │   Encrypted Slice Data    │ NAL Header │ ...      │
│  (clear)   │       (AES-CTR)           │  (clear)   │          │
└─────────────────────────────────────────────────────────────────┘
```

Video headers are left unencrypted so players can parse the stream structure without decryption.

## RSA Encryption

RSA is used for key exchange in DRM license protocols:

```
┌─────────────────────────────────────────────────────────────────┐
│                    RSA Key Exchange                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   License Server                           Client                │
│   ┌─────────────┐                    ┌─────────────┐            │
│   │ Private Key │                    │ Public Key  │            │
│   │  (Secret)   │                    │  (Known)    │            │
│   └─────────────┘                    └─────────────┘            │
│                                                                  │
│   1. Client encrypts request with server's public key           │
│                                                                  │
│   2. Only server can decrypt with its private key               │
│                                                                  │
│   3. Server encrypts content key with client's public key       │
│                                                                  │
│   4. Only client can decrypt with its private key               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### RSA in Widevine

```
License Request:
  - Device certificate (contains device public key)
  - Encrypted with server's public key

License Response:
  - Content key encrypted with device's public key
  - Only that device can decrypt
```

<RedTeamNote>
If an attacker extracts a device's private key, they can decrypt any license response meant for that device. This is why L1 devices store private keys in hardware.
</RedTeamNote>

## Digital Signatures

Signatures verify authenticity and integrity:

```
┌─────────────────────────────────────────────────────────────────┐
│                    Digital Signature                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   Signing (Server):                                             │
│   ┌─────────┐                                                   │
│   │ Message │──► Hash ──► Encrypt with ──► Signature           │
│   └─────────┘            Private Key                            │
│                                                                  │
│   Verification (Client):                                        │
│   ┌─────────┐                                                   │
│   │ Message │──► Hash ──┐                                       │
│   └─────────┘           │                                       │
│                         ├──► Compare ──► Valid/Invalid          │
│   ┌───────────┐         │                                       │
│   │ Signature │──► Decrypt with ──┘                             │
│   └───────────┘   Public Key                                    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

<BlueTeamNote>
License responses are always signed by the license server. Clients verify the signature to ensure the license hasn't been tampered with.
</BlueTeamNote>

## Key Hierarchy

DRM systems use key hierarchies for flexibility:

```
┌─────────────────────────────────────────────────────────────────┐
│                    Key Hierarchy                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌─────────────────────────────────────────────┐               │
│   │           Device Root Key                    │               │
│   │    (Burned into hardware or provisioned)    │               │
│   └───────────────────────┬─────────────────────┘               │
│                           │ Derives                              │
│                           ▼                                      │
│   ┌─────────────────────────────────────────────┐               │
│   │           Session Key                        │               │
│   │      (Unique per license session)           │               │
│   └───────────────────────┬─────────────────────┘               │
│                           │ Decrypts                             │
│                           ▼                                      │
│   ┌─────────────────────────────────────────────┐               │
│   │           Content Key                        │               │
│   │     (Decrypts the actual video/audio)       │               │
│   └─────────────────────────────────────────────┘               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

<KeyConcept term="Content Key">
The content key is the actual AES key that decrypts video and audio. It's never transmitted in plaintext - always encrypted within the license.
</KeyConcept>

## Practical Example

Here's how a video stream is protected:

```python
# Simplified encryption flow (conceptual)

# 1. Generate a random content key
content_key = generate_random_bytes(16)  # 128 bits

# 2. Generate an IV for each segment
iv = generate_random_bytes(16)

# 3. Encrypt video segment
ciphertext = aes_ctr_encrypt(
    plaintext=video_segment,
    key=content_key,
    iv=iv
)

# 4. Store key ID in PSSH box
pssh = create_pssh(
    key_id=key_id,
    drm_system_id=widevine_id
)

# 5. Package into DASH/HLS
manifest = create_manifest(
    segments=[ciphertext],
    pssh=pssh,
    iv=iv
)
```

## Common Vulnerabilities

<RedTeamNote title="Attack Vectors">
Attacks target the key, not the encryption:
- **Key extraction** from software CDMs
- **Memory dumping** during playback
- **Protocol attacks** on license exchange
- **Side-channel attacks** on hardware
</RedTeamNote>

<BlueTeamNote title="Defense in Depth">
Defenders protect keys through:
- Hardware security modules
- Obfuscated software
- Attestation and binding
- Anomaly detection
</BlueTeamNote>

## Summary

| Concept | Purpose in DRM |
|---------|---------------|
| AES-128 | Encrypts content |
| AES-CTR | Mode for streaming (Widevine, PlayReady) |
| AES-CBC | Mode for HLS (FairPlay) |
| RSA | Key exchange in licenses |
| Signatures | Verify license authenticity |
| CENC | Multi-DRM compatibility |

## Next Steps

- **[Encryption Lab](/labs/encryption)** - Hands-on AES encryption
- **[Key Exchange Lab](/labs/key-exchange)** - Visualize RSA exchange
- **[License Protocols](/knowledge-base/protocols)** - How keys are delivered
