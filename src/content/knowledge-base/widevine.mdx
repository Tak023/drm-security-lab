---
title: "Widevine DRM"
description: "Deep dive into Google's Widevine DRM system - architecture, security levels, and how it protects streaming content."
category: "drm-systems"
difficulty: "intermediate"
estimatedReadTime: 25
order: 2
tags: ["widevine", "google", "android", "chrome", "cdm"]
relatedArticles: ["overview", "fairplay", "playready", "encryption"]
---

# Widevine DRM

Widevine is Google's DRM technology, acquired in 2010 and now integrated across the Android ecosystem, Chrome browser, and countless smart TVs and streaming devices. It's the most widely deployed DRM system globally.

## Architecture Overview

Widevine consists of three main components:

```
┌─────────────────────────────────────────────────────────────────┐
│                    Widevine Architecture                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐    ┌──────────────┐    ┌──────────────┐       │
│  │   Widevine   │    │   License    │    │   Content    │       │
│  │     CDM      │◄──►│    Server    │◄──►│   Backend    │       │
│  └──────────────┘    └──────────────┘    └──────────────┘       │
│         │                                                        │
│         ▼                                                        │
│  ┌──────────────┐                                               │
│  │    OEMCrypto │  (Hardware abstraction layer)                 │
│  └──────────────┘                                               │
│         │                                                        │
│         ▼                                                        │
│  ┌──────────────┐                                               │
│  │     TEE      │  (Trusted Execution Environment)              │
│  └──────────────┘                                               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Content Decryption Module (CDM)

The CDM is a software module that handles:

- License request generation
- License response processing
- Key management
- Decryption operations (L3) or delegation to hardware (L1/L2)

<KeyConcept term="CDM">
The Content Decryption Module is a binary component provided by Google that implements the Widevine protocol. In Chrome, it's embedded in the browser. On Android, it's part of the system.
</KeyConcept>

### OEMCrypto

OEMCrypto is a hardware abstraction layer (HAL) that provides:

- Secure key storage
- Hardware-accelerated cryptography
- Trusted execution environment access

Device manufacturers implement OEMCrypto to interface with their specific security hardware.

## Security Levels

Widevine defines three security levels:

### Level 1 (L1) - Hardware Security

<SecurityLevel level="L1" description="All cryptographic operations and content decryption occur within a hardware Trusted Execution Environment (TEE)." />

**Characteristics:**
- Keys never leave the TEE
- Decrypted video stays in secure memory
- Required for HD (720p+) and 4K content
- Hardware root of trust

**Platforms:** Most Android phones/tablets, Android TV, Chromecast

```
┌─────────────────────────────────────────┐
│           L1 Security Model             │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────────────────────┐    │
│  │      Normal World (Android)     │    │
│  │  ┌─────────────────────────┐    │    │
│  │  │    Application/CDM       │    │    │
│  │  └───────────┬─────────────┘    │    │
│  └──────────────┼──────────────────┘    │
│                 │ (Secure call)         │
│  ┌──────────────▼──────────────────┐    │
│  │    Secure World (TEE/TrustZone) │    │
│  │  ┌─────────────────────────┐    │    │
│  │  │  Key Storage + Decrypt  │    │    │
│  │  └─────────────────────────┘    │    │
│  └─────────────────────────────────┘    │
│                                         │
└─────────────────────────────────────────┘
```

<BlueTeamNote>
L1 devices provide the strongest protection because keys are never exposed to the application processor. Even with root access, extracting keys is extremely difficult.
</BlueTeamNote>

### Level 2 (L2) - Partial Hardware

<SecurityLevel level="L2" description="Cryptographic operations occur in hardware, but content decryption is done in software." />

**Characteristics:**
- Keys protected in TEE
- Decryption happens in application processor
- Limited to SD quality on most services
- Vulnerable to memory attacks

**Use case:** Devices with secure elements but no secure video path

### Level 3 (L3) - Software Only

<SecurityLevel level="L3" description="All operations occur in software with no hardware protection. Most vulnerable to attacks." />

**Characteristics:**
- Keys stored in software
- All operations in application memory
- Limited to SD or lowest quality
- Chrome desktop browser uses L3

<RedTeamNote>
L3 implementations have been repeatedly compromised. The CDM can be reverse-engineered to extract the private keys, allowing license requests to be forged.
</RedTeamNote>

## License Protocol

Widevine uses a binary protocol over HTTP(S):

### 1. License Request (Challenge)

```
Client → Server:
{
  "signed_request": {
    "msg": <base64 encoded protobuf>,
    "signature": <client signature>
  }
}
```

The request contains:
- Device certificate chain
- Content Key ID(s)
- Session ID
- Client capabilities

### 2. License Response

```
Server → Client:
{
  "license": <base64 encoded protobuf>,
  "signature": <server signature>
}
```

The response contains:
- Encrypted content keys
- License policy (duration, restrictions)
- HDCP requirements

<InfoBox title="Protobuf Format">
Widevine uses Protocol Buffers (protobuf) for message serialization. The schema is not publicly documented, but has been reverse-engineered by researchers.
</InfoBox>

## Device Provisioning

Before a device can request licenses, it must be provisioned with a device certificate:

```
┌────────────┐         ┌──────────────┐         ┌────────────┐
│   Device   │         │  Provisioning │         │   Google   │
│            │         │    Server     │         │            │
└─────┬──────┘         └───────┬──────┘         └─────┬──────┘
      │                        │                      │
      │ 1. Request Cert        │                      │
      │───────────────────────►│                      │
      │                        │                      │
      │                        │ 2. Forward to Google │
      │                        │─────────────────────►│
      │                        │                      │
      │                        │ 3. Signed Certificate│
      │                        │◄─────────────────────│
      │                        │                      │
      │ 4. Store Certificate   │                      │
      │◄───────────────────────│                      │
```

<RedTeamNote title="Device Certificate Extraction">
On compromised L3 devices, attackers can extract the device private key and certificate, allowing them to impersonate that device type for license requests.
</RedTeamNote>

## Common Attack Vectors

### 1. CDM Reverse Engineering

Software CDMs (L3) can be analyzed to:
- Extract the client private key
- Understand the license protocol
- Create unofficial clients

### 2. Key Extraction

Methods include:
- Memory dumping during playback
- Hooking decryption functions
- Exploiting software vulnerabilities

### 3. Session Sharing

Valid license responses can potentially be:
- Captured and replayed
- Shared between devices
- Used with extracted keys

<BlueTeamNote title="Defense Strategies">
Content providers defend against these attacks using:
- Device attestation (SafetyNet/Play Integrity)
- Server-side session binding
- Anomaly detection for unusual patterns
- Rate limiting and geo-verification
</BlueTeamNote>

## Output Protection

Widevine enforces output restrictions through HDCP:

| Content Quality | Minimum HDCP |
|----------------|--------------|
| SD (480p) | None required |
| HD (720p/1080p) | HDCP 1.4 |
| UHD (4K) | HDCP 2.2 |

<KeyConcept term="HDCP">
High-bandwidth Digital Content Protection (HDCP) encrypts the video signal between the device and display, preventing capture of the decrypted video.
</KeyConcept>

## Implementation in Browsers

### Chrome

Chrome includes the Widevine CDM as a binary component (Level 3):

```
Chrome
├── CDM (Widevine) - L3
│   ├── License handling
│   ├── Key management
│   └── Decryption
└── Encrypted Media Extensions (EME)
    └── JavaScript API
```

### EME Integration

Websites use the Encrypted Media Extensions API:

```javascript
// Simplified EME flow
const video = document.querySelector('video');
const config = [{
  initDataTypes: ['cenc'],
  videoCapabilities: [{
    contentType: 'video/mp4; codecs="avc1.42E01E"'
  }],
  audioCapabilities: [{
    contentType: 'audio/mp4; codecs="mp4a.40.2"'
  }]
}];

navigator.requestMediaKeySystemAccess('com.widevine.alpha', config)
  .then(access => access.createMediaKeys())
  .then(keys => video.setMediaKeys(keys))
  .then(() => {
    // Create session and handle license exchange
  });
```

## Summary

- Widevine is the most widely deployed DRM, covering Android, Chrome, and smart devices
- Three security levels (L1-L3) determine content quality restrictions
- L1 provides hardware protection; L3 is software-only and more vulnerable
- The license protocol uses protobuf messages over HTTPS
- Device provisioning establishes trust before content access
- HDCP enforces output protection requirements

## Next Steps

- **[Encryption Basics](/knowledge-base/encryption)** - Understand the cryptography
- **[License Server Lab](/labs/license-server)** - Interact with a mock Widevine server
- **[CDM Extraction](/labs/attacks/cdm-extraction)** - Learn about L3 vulnerabilities
